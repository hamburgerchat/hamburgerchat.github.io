class ImageGeneratorBot {
    constructor() {
        this.name = "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–§–æ—Ç–æ";
        this.greetings = ["–ø—Ä–∏–≤–µ—Ç", "hello", "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π", "—Ö–∞–π", "–∫—É"];
        this.farewells = ["–ø–æ–∫–∞", "–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è", "–ø—Ä–æ—â–∞–π", "bye"];
        this.requests = ["—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π", "–Ω–∞—Ä–∏—Å—É–π", "—Å–æ–∑–¥–∞–π", "–ø–æ–∫–∞–∂–∏", "—Ñ–æ—Ç–æ", "–∫–∞—Ä—Ç–∏–Ω–∫—É", "–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"];
        this.translations = {
            "–∫–æ—à–∫–∞": "cat",
            "—Å–æ–±–∞–∫–∞": "dog",
            "–¥–µ—Ä–µ–≤–æ": "tree",
            "–≥–æ—Ä–æ–¥": "city",
            "–ª–µ—Å": "forest",
            "–º–æ—Ä–µ": "sea",
            "–≥–æ—Ä—ã": "mountains",
            "–∫–æ—Å–º–æ—Å": "space",
            "–∫–æ—Å–º–æ–Ω–∞–≤—Ç": "astronaut",
            "—Ä–æ–±–æ—Ç": "robot",
            "–¥—Ä–∞–∫–æ–Ω": "dragon",
            "–µ–¥–∏–Ω–æ—Ä–æ–≥": "unicorn",
            "–∑–∞–∫–∞—Ç": "sunset",
            "—Ä–∞—Å—Å–≤–µ—Ç": "sunrise",
            "—Ü–≤–µ—Ç—ã": "flowers",
            "–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞": "architecture",
            "—Ñ—ç–Ω—Ç–µ–∑–∏": "fantasy",
            "–Ω–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞": "sci-fi",
            "–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è": "abstract",
            "–ø–æ—Ä—Ç—Ä–µ—Ç": "portrait",
            "–ø–µ–π–∑–∞–∂": "landscape",
            "–∂–∏–≤–æ—Ç–Ω–æ–µ": "animal",
            "–ø—Ç–∏—Ü–∞": "bird",
            "—Ä—ã–±–∞": "fish",
            "–Ω–∞—Å–µ–∫–æ–º–æ–µ": "insect",
            "–µ–¥–∞": "food",
            "—Ñ—Ä—É–∫—Ç—ã": "fruits",
            "–æ–≤–æ—â–∏": "vegetables",
            "–º–∞—à–∏–Ω–∞": "car",
            "—Å–∞–º–æ–ª–µ—Ç": "airplane",
            "–∫–æ—Ä–∞–±–ª—å": "ship",
            "–∑–¥–∞–Ω–∏–µ": "building",
            "–¥–æ–º": "house",
            "—É–ª–∏—Ü–∞": "street",
            "–ø–∞—Ä–∫": "park",
            "—Å–∞–¥": "garden",
            "—Ä–µ–∫–∞": "river",
            "–æ–∑–µ—Ä–æ": "lake",
            "–æ–∫–µ–∞–Ω": "ocean",
            "–ø–ª—è–∂": "beach",
            "–ø—É—Å—Ç—ã–Ω—è": "desert",
            "—Å–Ω–µ–≥": "snow",
            "–¥–æ–∂–¥—å": "rain",
            "—à—Ç–æ—Ä–º": "storm",
            "–º–æ–ª–Ω–∏—è": "lightning",
            "—Ä–∞–¥—É–≥–∞": "rainbow",
            "–æ–±–ª–∞–∫–∞": "clouds",
            "–∑–≤–µ–∑–¥—ã": "stars",
            "–ø–ª–∞–Ω–µ—Ç–∞": "planet",
            "–≥–∞–ª–∞–∫—Ç–∏–∫–∞": "galaxy",
            "—á—ë—Ä–Ω–∞—è –¥—ã—Ä–∞": "black hole",
            "—Å—É–ø–µ—Ä–≥–µ—Ä–æ–π": "superhero",
            "—Ñ–µ—è": "fairy",
            "–≤–æ–ª—à–µ–±–Ω–∏–∫": "wizard",
            "—Ä—ã—Ü–∞—Ä—å": "knight",
            "–∑–∞–º–æ–∫": "castle",
            "–ø–µ—â–µ—Ä–∞": "cave",
            "–æ—Å—Ç—Ä–æ–≤": "island",
            "–≤–æ–¥–æ–ø–∞–¥": "waterfall",
            "–≤—É–ª–∫–∞–Ω": "volcano",
            "–æ–≥–æ–Ω—å": "fire",
            "–≤–æ–¥–∞": "water",
            "–≤–æ–∑–¥—É—Ö": "air",
            "–∑–µ–º–ª—è": "earth"
        };
    }

    async onStart(context) {
        await context.reply({
            text: "üé® –ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π!\n\n" +
                  "–Ø –º–æ–≥—É —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–æ —Ç–≤–æ–µ–º—É –æ–ø–∏—Å–∞–Ω–∏—é.\n\n" +
                  "**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**\n" +
                  "‚Ä¢ –ù–∞–ø–∏—à–∏ —á—Ç–æ —Ö–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ\n" +
                  "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–æ–≤–∞: \"—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π\", \"–Ω–∞—Ä–∏—Å—É–π\", \"—Å–æ–∑–¥–∞–π\"\n\n" +
                  "**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**\n" +
                  "‚Ä¢ \"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–æ—Å–º–æ–Ω–∞–≤—Ç–∞ –≤ –∫–æ—Å–º–æ—Å–µ\"\n" +
                  "‚Ä¢ \"–ù–∞—Ä–∏—Å—É–π –≤–æ–ª—à–µ–±–Ω—ã–π –ª–µ—Å —Å –µ–¥–∏–Ω–æ—Ä–æ–≥–æ–º\"\n" +
                  "‚Ä¢ \"–°–æ–∑–¥–∞–π —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥\"\n\n" +
                  "–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏, —á—Ç–æ —Ö–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å! ‚ú®"
        });
    }

    async onMessage(message, context) {
        const text = message.text.toLowerCase().trim();

        // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        if (this.greetings.some(greet => text.includes(greet))) {
            await context.reply({
                text: `üëã –ü—Ä–∏–≤–µ—Ç, ${context.userName}! –ì–æ—Ç–æ–≤ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è! üé®\n\n` +
                      "–ù–∞–ø–∏—à–∏, —á—Ç–æ —Ö–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ, –∏ —è –µ—ë —Å–≥–µ–Ω–µ—Ä–∏—Ä—É—é!"
            });
            return;
        }

        // –ü—Ä–æ—â–∞–Ω–∏–µ
        if (this.farewells.some(farewell => text.includes(farewell))) {
            await context.reply({
                text: "üëã –ü–æ–∫–∞! –í–æ–∑–≤—Ä–∞—â–∞–π—Å—è, –∫–æ–≥–¥–∞ –∑–∞—Ö–æ—á–µ—à—å —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è! üé®"
            });
            return;
        }

        // –ü–æ–º–æ—â—å
        if (text.includes("–ø–æ–º–æ—â—å") || text.includes("—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å")) {
            await this.showHelp(context);
            return;
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        if (this.requests.some(request => text.includes(request)) || this.shouldGenerateImage(text)) {
            await this.generateImage(text, context);
            return;
        }

        // –û—Ç–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        await context.reply({
            text: "üé® –•–æ—á–µ—à—å, —á—Ç–æ–±—ã —è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ? –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏, —á—Ç–æ —Ö–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å!\n\n" +
                  "–ù–∞–ø—Ä–∏–º–µ—Ä: \"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ä–∞–±–ª—å\" –∏–ª–∏ \"–ù–∞—Ä–∏—Å—É–π –∑–∞–∫–∞—Ç –≤ –≥–æ—Ä–∞—Ö\""
        });
    }

    shouldGenerateImage(text) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∑–∞–ø—Ä–æ—Å —Å–ª–æ–≤–∞, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
        const visualWords = ["—Ñ–æ—Ç–æ", "–∫–∞—Ä—Ç–∏–Ω–∫", "–∏–∑–æ–±—Ä–∞–∂–µ–Ω", "—Ä–∏—Å—É–Ω", "–∞—Ä—Ç", "—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ", "–∏–ª–ª—é—Å—Ç—Ä–∞—Ü"];
        return visualWords.some(word => text.includes(word));
    }

    async generateImage(userPrompt, context) {
        try {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
            await context.reply({
                text: "üîÑ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ ‚è≥"
            });

            // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø—Ä–æ–º–ø—Ç –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const prompt = this.extractPrompt(userPrompt);
            
            if (!prompt) {
                await context.reply({
                    text: "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Ç–æ—á–Ω–∏, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç—ã —Ö–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏.\n\n" +
                          "–ù–∞–ø—Ä–∏–º–µ—Ä: \"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–æ—Å–º–æ–Ω–∞–≤—Ç–∞ –≤ –∫–æ—Å–º–æ—Å–µ\" –∏–ª–∏ \"–ù–∞—Ä–∏—Å—É–π –≤–æ–ª—à–µ–±–Ω—ã–π –ª–µ—Å\""
                });
                return;
            }

            // –ü–µ—Ä–µ–≤–æ–¥–∏–º –ø—Ä–æ–º–ø—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
            const englishPrompt = this.translateToEnglish(prompt);
            
            // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const imageUrl = this.createImageUrl(englishPrompt);

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            await context.reply({
                text: `‚úÖ –í–æ—Ç —Ç–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!\n\n**–ó–∞–ø—Ä–æ—Å:** ${prompt}\n**–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é Lyriel 1.5**`,
                image: imageUrl
            });

            // –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –µ—â–µ
            await context.reply({
                text: "–•–æ—á–µ—à—å —Å–æ–∑–¥–∞—Ç—å –µ—â–µ –æ–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ? –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å! üé®"
            });

        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:", error);
            await context.reply({
                text: "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –∏–∑–º–µ–Ω–∏ –∑–∞–ø—Ä–æ—Å."
            });
        }
    }

    extractPrompt(userText) {
        // –£–¥–∞–ª—è–µ–º –∫–æ–º–∞–Ω–¥—ã –∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ
        let prompt = userText.toLowerCase();
        
        // –£–¥–∞–ª—è–µ–º –∫–æ–º–∞–Ω–¥—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        this.requests.forEach(request => {
            prompt = prompt.replace(request, '');
        });
        
        // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ —Å–ª–æ–≤–∞
        const removeWords = ["–ø–æ–∂–∞–ª—É–π—Å—Ç–∞", "–º–Ω–µ", "—Ö–æ—á—É", "–º–æ–∂–Ω–æ", "—Å–¥–µ–ª–∞–π", "—Å–æ–∑–¥–∞–π", "–Ω–∞—Ä–∏—Å—É–π", "–ø–æ–∫–∞–∂–∏"];
        removeWords.forEach(word => {
            prompt = prompt.replace(new RegExp(`\\b${word}\\b`, 'g'), '');
        });

        // –û—á–∏—â–∞–µ–º –ø—Ä–æ–±–µ–ª—ã
        prompt = prompt.trim().replace(/\s+/g, ' ');

        return prompt || userText;
    }

    translateToEnglish(russianPrompt) {
        let englishPrompt = russianPrompt.toLowerCase();
        
        // –ó–∞–º–µ–Ω—è–µ–º —Ä—É—Å—Å–∫–∏–µ —Å–ª–æ–≤–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ
        for (const [ru, en] of Object.entries(this.translations)) {
            const regex = new RegExp(`\\b${ru}\\b`, 'gi');
            englishPrompt = englishPrompt.replace(regex, en);
        }

        // –£–ª—É—á—à–∞–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const enhancements = [
            "high quality", "detailed", "beautiful", "artistic", 
            "professional", "vibrant colors", "sharp focus"
        ];

        // –î–æ–±–∞–≤–ª—è–µ–º 2 —Å–ª—É—á–∞–π–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏—è
        const randomEnhancements = enhancements
            .sort(() => Math.random() - 0.5)
            .slice(0, 2)
            .join(', ');

        return `${englishPrompt}, ${randomEnhancements}, digital art`;
    }

    createImageUrl(prompt) {
        // –ö–æ–¥–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è URL
        const encodedPrompt = encodeURIComponent(prompt);
        
        // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è API –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        return `https://image.pollinations.ai/prompt/${encodedPrompt}?height=1000&width=1000&enhance=true&nologo=true&model=lyriel-1.5-clean`;
    }

    async showHelp(context) {
        await context.reply({
            text: "üé® **–ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—É**\n\n" +
                  "**–ß—Ç–æ —è —É–º–µ—é:**\n" +
                  "‚Ä¢ –°–æ–∑–¥–∞–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é\n" +
                  "‚Ä¢ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ç—ã –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∏–ª—è—Ö\n" +
                  "‚Ä¢ –†–∞–±–æ—Ç–∞—Ç—å —Å —Ä—É—Å—Å–∫–∏–º–∏ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏\n\n" +
                  "**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**\n" +
                  "–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏, —á—Ç–æ —Ö–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å!\n\n" +
                  "**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**\n" +
                  "‚Ä¢ \"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–æ—Å–º–æ–Ω–∞–≤—Ç–∞ –≤ –∫–æ—Å–º–æ—Å–µ\"\n" +
                  "‚Ä¢ \"–ù–∞—Ä–∏—Å—É–π –≤–æ–ª—à–µ–±–Ω—ã–π –ª–µ—Å —Å –µ–¥–∏–Ω–æ—Ä–æ–≥–æ–º\"\n" +
                  "‚Ä¢ \"–°–æ–∑–¥–∞–π —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥ –±—É–¥—É—â–µ–≥–æ\"\n" +
                  "‚Ä¢ \"–§–æ—Ç–æ –∑–∞–∫–∞—Ç–∞ –Ω–∞ –º–æ—Ä–µ\"\n" +
                  "‚Ä¢ \"–ö—Ä–∞—Å–∏–≤—ã–π –ø–µ–π–∑–∞–∂ —Å –≥–æ—Ä–∞–º–∏\"\n\n" +
                  "**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–µ–º—ã:**\n" +
                  "–ü—Ä–∏—Ä–æ–¥–∞, –∂–∏–≤–æ—Ç–Ω—ã–µ, –∫–æ—Å–º–æ—Å, —Ñ—ç–Ω—Ç–µ–∑–∏, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ø–æ—Ä—Ç—Ä–µ—Ç—ã –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ!\n\n" +
                  "–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π –∑–∞–ø—Ä–æ—Å –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º! ‚ú®"
        });
    }

    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    async generateImageFromPrompt(prompt) {
        const englishPrompt = this.translateToEnglish(prompt);
        return this.createImageUrl(englishPrompt);
    }
}

// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
class ImageGeneratorBotWithButtons extends ImageGeneratorBot {
    constructor() {
        super();
        this.name = "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–§–æ—Ç–æ+";
        this.popularPrompts = [
            "–ö–æ—Å–º–æ–Ω–∞–≤—Ç –≤ –∫–æ—Å–º–æ—Å–µ",
            "–í–æ–ª—à–µ–±–Ω—ã–π –ª–µ—Å",
            "–§—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥",
            "–ó–∞–∫–∞—Ç –Ω–∞ –º–æ—Ä–µ",
            "–ï–¥–∏–Ω–æ—Ä–æ–≥ –≤ —Ä–∞–¥—É–≥–µ",
            "–î—Ä–∞–∫–æ–Ω –≤ –≥–æ—Ä–∞—Ö",
            "–ö–∏–±–µ—Ä–ø–∞–Ω–∫ —É–ª–∏—Ü–∞",
            "–°—Ä–µ–¥–∏–∑–µ–º—å–µ –ø–µ–π–∑–∞–∂",
            "–ü–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä",
            "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è"
        ];
    }

    async onStart(context) {
        await context.reply({
            text: "üé® –ü—Ä–∏–≤–µ—Ç! –Ø –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –±–æ—Ç-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π!\n\n" +
                  "–í—ã–±–µ—Ä–∏ –≥–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω –∏–ª–∏ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π –∑–∞–ø—Ä–æ—Å!",
            buttons: this.generateMainButtons()
        });
    }

    async onMessage(message, context) {
        const text = message.text.toLowerCase().trim();

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
        if (context.buttonPayload) {
            await this.handleButton(context.buttonPayload, context);
            return;
        }

        // –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
        const quickPrompt = this.popularPrompts.find(prompt => 
            text.includes(prompt.toLowerCase().split(' ')[0])
        );
        
        if (quickPrompt) {
            await this.generateImage(quickPrompt, context);
            return;
        }

        await super.onMessage(message, context);
    }

    generateMainButtons() {
        const buttons = [];
        
        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ (–ø–æ 2 –≤ —Ä—è–¥—É)
        for (let i = 0; i < this.popularPrompts.length; i += 2) {
            const row = [];
            if (this.popularPrompts[i]) {
                row.push({ 
                    type: "text", 
                    label: `üé® ${this.popularPrompts[i].split(' ')[0]}...`,
                    payload: `prompt_${i}`
                });
            }
            if (this.popularPrompts[i + 1]) {
                row.push({ 
                    type: "text", 
                    label: `üé® ${this.popularPrompts[i + 1].split(' ')[0]}...`,
                    payload: `prompt_${i + 1}`
                });
            }
            buttons.push(row);
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
        buttons.push([
            { type: "text", label: "‚ùì –ü–æ–º–æ—â—å", payload: "help" },
            { type: "text", label: "üí° –°–≤–æ–π –∑–∞–ø—Ä–æ—Å", payload: "custom" }
        ]);

        return buttons;
    }

    async handleButton(payload, context) {
        if (payload.startsWith('prompt_')) {
            const index = parseInt(payload.split('_')[1]);
            const prompt = this.popularPrompts[index];
            await this.generateImage(prompt, context);
        } else if (payload === 'help') {
            await this.showHelp(context);
        } else if (payload === 'custom') {
            await context.reply({
                text: "üí° –ù–∞–ø–∏—à–∏ —Å–≤–æ–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è!\n\n" +
                      "–ù–∞–ø—Ä–∏–º–µ—Ä: \"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–æ—Ç–∞ –≤ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–º —à–ª–µ–º–µ\" –∏–ª–∏ \"–ù–∞—Ä–∏—Å—É–π –∑–∞–º–æ–∫ –≤ –æ–±–ª–∞–∫–∞—Ö\""
            });
        }
    }

    async showHelp(context) {
        await context.reply({
            text: "üé® **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**\n\n" +
                  "**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**\n" +
                  "‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ —à–∞–±–ª–æ–Ω–∞–º\n" +
                  "‚Ä¢ –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º/–∞–Ω–≥–ª–∏–π—Å–∫–æ–º\n" +
                  "‚Ä¢ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (1000x1000px)\n" +
                  "‚Ä¢ –°—Ç–∏–ª—å digital art\n\n" +
                  "**–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∫–Ω–æ–ø–∫–∞–º!**",
            buttons: [
                [
                    { type: "text", label: "üé® –í—ã–±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω", payload: "back" },
                    { type: "text", label: "üí° –°–≤–æ–π –∑–∞–ø—Ä–æ—Å", payload: "custom" }
                ]
            ]
        });
    }
}

// –≠–∫—Å–ø–æ—Ä—Ç –±–æ—Ç–æ–≤
if (typeof module !== 'undefined') {
    module.exports = { ImageGeneratorBot, ImageGeneratorBotWithButtons };
}
