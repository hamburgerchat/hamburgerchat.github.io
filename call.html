async function startCall() {
    if (isGroupChat || isChannel) {
        alert('–ó–≤–æ–Ω–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω—ã—Ö —á–∞—Ç–∞—Ö');
        return;
    }
    
    if (!isGroupMember) {
        alert('–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –∑–≤–æ–Ω–∏—Ç—å –≤ —ç—Ç–æ–º —á–∞—Ç–µ');
        return;
    }
    
    try {
        const callId = 'call_' + Date.now();
        
        const otherUserId = Object.keys(currentChatData.participants).find(id => id !== currentUserId);
        if (!otherUserId) {
            throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞');
        }

        // –°–æ–∑–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–≤–æ–Ω–∫–∞
        const callData = {
            id: callId,
            sender: currentUserId,
            participants: [currentUserId, otherUserId],
            status: 'waiting',
            createdAt: Date.now(),
            chatId: currentChatId
        };

        const encryptedCallData = encryptData(callData);
        
        await database.ref(`calls/${callId}`).set({
            encryptedData: encryptedCallData,
            createdAt: Date.now(),
            status: 'waiting'
        });

        const callMessageData = {
            type: 'call',
            callId: callId,
            sender: currentUserId,
            timestamp: Date.now(),
            status: 'waiting'
        };
        
        const encrypted = encryptData(callMessageData);
        const messageId = Date.now().toString();
        
        await database.ref(`messages/${currentChatId}/${messageId}`).set({
            encryptedData: encrypted,
            timestamp: Date.now()
        });
        
        await updateLastMessage('üìû –í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫');
        
        showNotification('–ó–≤–æ–Ω–æ–∫ –Ω–∞—á–∞—Ç');
        
        // –ü–µ—Ä–µ–∫–∏–¥—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–≤–æ–Ω–∫–∞
        window.open(`https://hamburgerchat.github.io/call.html?id=${callId}`, '_blank');
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –Ω–∞—á–∞–ª–∞ –∑–≤–æ–Ω–∫–∞:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –∑–≤–æ–Ω–∫–∞: ' + error.message);
    }
}
